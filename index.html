<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #87CEEB;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let GRAVITY = 0.000000000001 * window.innerHeight;
        let FLAP_STRENGTH = -0.15 * window.innerHeight;
        let PIPE_WIDTH = 0.15 * window.innerWidth;
        let PIPE_SPEED = 0.005 * window.innerWidth;

        const birdImg = new Image();
        birdImg.src = './bird.png';

        const backgroundImg = new Image();
        backgroundImg.src = './background_ipad_ratio.png';

        let bird;
        let pipes = [];
        let score = 0;
        let gameActive = true;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            adjustGameConstants();
        }

        function adjustGameConstants() {
            GRAVITY = 0.001 * canvas.height;
            FLAP_STRENGTH = -0.02 * canvas.height;
            PIPE_WIDTH = 0.15 * canvas.width;
            PIPE_SPEED = 0.005 * canvas.width;

            if (!bird) {
                bird = { x: 0.1 * canvas.width, y: canvas.height / 2, velocity: 0 };
            } else {
                bird.x = 0.1 * canvas.width;
                bird.y = canvas.height / 2;
                bird.velocity = 0;
            }
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); // Initial resize

        let pipeDelay = Math.random() * 100 + 150; // Randomize initial pipe delay
        let pipeTimer = 0;

        function createPipe() {
            const pipeGap = Math.random() * 0.2 * canvas.height + 0.25 * canvas.height; // Randomize gap size
            const height = Math.random() * (canvas.height - pipeGap - 0.1 * canvas.height) + 0.1 * canvas.height; // Randomize opening position
            pipes.push({ x: canvas.width, height, gap: pipeGap });
        }

        function resetGame() {
            bird = { x: 0.1 * canvas.width, y: canvas.height / 2, velocity: 0 };
            pipes = [];
            score = 0;
            gameActive = true;
            pipeTimer = 0;
            pipeDelay = Math.random() * 100 + 150; // Reset random delay
            createPipe();
        }

        function drawBird() {
            ctx.drawImage(birdImg, bird.x, bird.y, 0.1 * canvas.width, 0.1 * canvas.width);
        }

        function drawPipes() {
            pipes.forEach(pipe => {
                ctx.fillStyle = 'green';
                ctx.fillRect(pipe.x, 0, PIPE_WIDTH, pipe.height);
                ctx.fillRect(pipe.x, pipe.height + pipe.gap, PIPE_WIDTH, canvas.height - pipe.height - pipe.gap);
            });
        }

        function updateBird() {
            bird.velocity += GRAVITY;
            bird.y += bird.velocity;
        }

        function updatePipes() {
            pipes.forEach(pipe => {
                pipe.x -= PIPE_SPEED;
            });

            if (pipes[0] && pipes[0].x + PIPE_WIDTH < 0) {
                pipes.shift();
                score++;
            }

            pipeTimer++;
            if (pipeTimer >= pipeDelay) {
                createPipe();
                pipeTimer = 0;
                pipeDelay = Math.random() * 100 + 150; // Randomize next pipe delay
            }
        }

        function checkCollision() {
            if (bird.y <= 0 || bird.y + 0.05 * canvas.width >= canvas.height) {
                gameActive = false;
            }

            pipes.forEach(pipe => {
                if (
                    bird.x + 0.05 * canvas.width > pipe.x &&
                    bird.x < pipe.x + PIPE_WIDTH &&
                    (bird.y < pipe.height || bird.y + 0.05 * canvas.width > pipe.height + pipe.gap)
                ) {
                    gameActive = false;
                }
            });
        }

        function gameOverScreen() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'white';
            ctx.font = `${Math.floor(0.05 * canvas.width)}px Arial`;
            ctx.textAlign = 'center';
            ctx.fillText(`Game Over! Score: ${score}`, canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillText('Click to Restart', canvas.width / 2, canvas.height / 2 + 20);
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);

            if (gameActive) {
                updateBird();
                updatePipes();
                checkCollision();
                drawPipes();
                drawBird();

                ctx.fillStyle = 'black';
                ctx.font = `${Math.floor(0.03 * canvas.width)}px Arial`;
                ctx.fillText(`Score: ${score}`, 10, 30);
            } else {
                gameOverScreen();
            }

            requestAnimationFrame(gameLoop);
        }

        document.addEventListener('keydown', e => {
            if (e.code === 'Space' && gameActive) {
                bird.velocity = FLAP_STRENGTH;
            }
        });

        canvas.addEventListener('click', () => {
            if (!gameActive) {
                resetGame();
            } else {
                bird.velocity = FLAP_STRENGTH;
            }
        });

        createPipe();
        gameLoop();
    </script>
</body>
</html>
